<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Sistem Informasi Laporan Kemajuan Siswa - Bimbel Gambar Villa Merah (Supabase)</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
<script type="module">
  import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';
  const SUPABASE_URL = 'https://xopxgeexxptomzvegvmf.supabase.co';
  const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhvcHhnZWV4eHB0b216dmVndm1mIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMwNDAyNjMsImV4cCI6MjA3ODYxNjI2M30.GLUEjYeqaDwyl21uds2t58RYVqNez-4onbbtPyVXZ0w';
  window.supabase = createClient(SUPABASE_URL, SUPABASE_KEY);
</script>
<style>
body { box-sizing: border-box; }
* { box-sizing: border-box; }
.sidebar-active { background-color: #1e40af; color: white; }
.fade-in { animation: fadeIn 0.3s ease-in; }
@keyframes fadeIn { from { opacity: 0; transform: translateY(10px) } to { opacity: 1; transform: translateY(0) } }
.notification { position: fixed; top:20px; right:20px; z-index:1000; padding:12px 24px; border-radius:8px; color:white; font-weight:500; animation: slideIn 0.3s ease-out }
@keyframes slideIn { from { transform: translateX(100%); opacity:0 } to { transform: translateX(0); opacity:1 } }
.success { background-color:#10b981 } .error { background-color:#ef4444 }
</style>
</head>
<body class="bg-white">
<div id="loginPage" class="min-h-screen flex items-center justify-center py-15 px-4 relative">
  <div class="max-w-md w-full space-y-8 bg-white/90 p-8 rounded-2xl shadow-2xl backdrop-blur-md">
    <h2 class="text-2xl text-center font-bold text-gray-900 mb-2 text-red-600">Bimbel Gambar Villa Merah</h2>
    <h3 class="text-1xl text-center font-semibold text-blue-600">Laporan Kemajuan Siswa</h3>
    <form class="mt-8 space-y-6" id="loginForm">
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1" for="username">Username</label>
        <input id="username" name="username" class="w-full px-3 py-2 border rounded" type="text" placeholder="Masukkan username" required />
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-1" for="password">Password</label>
        <input id="password" name="password" class="w-full px-3 py-2 border rounded" type="password" placeholder="Masukkan password" required />
      </div>
      <button class="w-full bg-blue-600 hover:bg-blue-700 text-white py-2 rounded" type="submit">Masuk</button>
    </form>
  </div>
</div>
<div id="dashboardPage" class="hidden min-h-screen p-8">
  <h1 class="text-3xl font-bold mb-4">Dashboard</h1>
  <div id="contentArea" class="fade-in text-gray-800"></div>
  <button id="logoutBtn" class="mt-4 px-4 py-2 bg-red-600 text-white rounded">Keluar</button>
</div>
<script>
let currentUser = null;
let studentsData = [], regionalAdmins = [], scheduleData = [];
function showNotification(msg,type='success'){const n=document.createElement('div');n.className=`notification ${type}`;n.textContent=msg;document.body.appendChild(n);setTimeout(()=>n.remove(),3000);}
async function loadAllData(){try{const {data:students}=await window.supabase.from('students').select('*');studentsData=students||[];const {data:admins}=await window.supabase.from('admins').select('*');regionalAdmins=admins||[];const {data:sched}=await window.supabase.from('schedules').select('*');scheduleData=sched||[];console.log('Data loaded from Supabase');}catch(e){console.error('Load failed',e);}}
function saveSession(){localStorage.setItem('currentUser',JSON.stringify(currentUser));}
function logout(){localStorage.removeItem('currentUser');currentUser=null;document.getElementById('dashboardPage').classList.add('hidden');document.getElementById('loginPage').classList.remove('hidden');}
function showDashboard(){document.getElementById('loginPage').classList.add('hidden');document.getElementById('dashboardPage').classList.remove('hidden');document.getElementById('contentArea').innerHTML=`Halo, <b>${currentUser.name||currentUser.username}</b>! Data kamu sekarang online.`;}
document.getElementById('loginForm').addEventListener('submit',async e=>{e.preventDefault();const username=document.getElementById('username').value;const password=document.getElementById('password').value;try{const {data:admin}=await window.supabase.from('admins').select('*').eq('username',username).eq('password',password).maybeSingle();if(admin){currentUser=admin;showDashboard();saveSession();return;}const {data:student}=await window.supabase.from('students').select('*').eq('username',username).eq('password',password).maybeSingle();if(student){currentUser=student;showDashboard();saveSession();return;}showNotification('Username atau password salah','error');}catch(err){console.error(err);showNotification('Gagal login','error');}});
document.getElementById('logoutBtn').addEventListener('click',logout);
window.addEventListener('DOMContentLoaded',async()=>{await loadAllData();const cu=localStorage.getItem('currentUser');if(cu){currentUser=JSON.parse(cu);showDashboard();}});
</script>
</body>
</html>
